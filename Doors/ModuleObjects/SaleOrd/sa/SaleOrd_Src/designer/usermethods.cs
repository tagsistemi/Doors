using Wv2Edge;
using WinSCP;
using System.Threading.Channels;
using System.Text.Json.Serialization;
using System.Text.Json;
using System.Text.Encodings.Web;
using System.Text.Unicode;
using System.Numerics;
using System.Buffers.Binary;
using System.Buffers.Text;
using System.IO.Pipelines;
using System.Runtime.InteropServices;
using System.IO.MemoryMappedFiles;
using System.Threading;
using System.IO.Pipes;
using System.IO;
using System.Diagnostics.PerformanceData;
using System.Diagnostics;
using System.Linq.Expressions;
using System.Dynamic;
using System.Security.Cryptography.X509Certificates;
using System.Security.Cryptography;
using System.Security;
using Microsoft.Win32.SafeHandles;
using System.Linq;
using System.Diagnostics.Eventing.Reader;
using System.Management.Instrumentation;
using System.Diagnostics.Eventing;
using System.ComponentModel.DataAnnotations.Schema;
using System.ComponentModel.DataAnnotations;
using System.Buffers;
using RestSharp.Validation;
using RestSharp.Serializers;
using RestSharp.Contrib;
using RestSharp.Extensions;
using RestSharp.Deserializers;
using RestSharp.Authenticators.OAuth;
using RestSharp.Authenticators;
using RestSharp;
using Renci.SshNet.Common;
using Renci.SshNet.Compression;
using Renci.SshNet.Messages.Authentication;
using Renci.SshNet.Messages.Connection;
using Renci.SshNet.Messages.Transport;
using Renci.SshNet.Messages;
using Renci.SshNet.Security.Cryptography.Ciphers.Modes;
using Renci.SshNet.Security.Cryptography.Ciphers.Paddings;
using Renci.SshNet.Security.Cryptography.Ciphers;
using Renci.SshNet.Security.Cryptography;
using Renci.SshNet.Security;
using Renci.SshNet.Sftp;
using Renci.SshNet;
using OpenCartGateClasses;
using Newtonsoft.Json.Bson;
using Newtonsoft.Json.Converters;
using Newtonsoft.Json.Linq;
using Newtonsoft.Json.Schema;
using Newtonsoft.Json.Serialization;
using Newtonsoft.Json;
using Microsoft.Web.WebView2.WinForms;
using Microsoft.Web.WebView2.Core.Raw;
using Microsoft.Web.WebView2.Core;
using Microsoft.Extensions.Primitives;
using Microsoft.Extensions.Options;
using Microsoft.Extensions.Logging.Abstractions;
using Microsoft.Extensions.Logging;
using Microsoft.Extensions.DependencyInjection.Extensions;
using Microsoft.Extensions.Configuration.Memory;
using Microsoft.Extensions.Configuration;
using System.Threading.Tasks.Sources;
using System.Threading.Tasks;
using System.Runtime.CompilerServices;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.AspNetCore.SignalR.Protocol;
using Microsoft.AspNetCore.SignalR;
using Microsoft.AspNetCore.SignalR.Client;
using Microsoft.AspNetCore.Http.Features.Authentication;
using Microsoft.AspNetCore.Http.Features;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Http.Connections;
using Microsoft.AspNetCore.Http.Connections.Client;
using Microsoft.AspNetCore.Connections.Features;
using Microsoft.AspNetCore.Connections;
using MagoNet.Activation.Library;
using GiglioFattClassLibrary;
using ElaboratoreOrdiniClasses;
using DoorsAddoOnLibrary.Models;
using DoorsAddoOnLibrary.BillOfMaterialsComponents;
using DoorsAddoOnLibrary.LoginManager;
using DoorsAddoOnLibrary.TbServices;
using DoorsAddoOnLibrary;
using DevExpress.XtraVerticalGrid.Utils;
using DevExpress.XtraVerticalGrid.ViewInfo;
using DevExpress.XtraVerticalGrid.Events;
using DevExpress.XtraVerticalGrid.Editors;
using DevExpress.XtraVerticalGrid.Painters;
using DevExpress.XtraVerticalGrid.Localization;
using DevExpress.XtraVerticalGrid.Internal;
using DevExpress.XtraVerticalGrid.Design;
using DevExpress.XtraVerticalGrid.Data;
using DevExpress.XtraVerticalGrid.Rows;
using DevExpress.XtraVerticalGrid.Blending;
using DevExpress.XtraVerticalGrid;
using DevExpress.XtraVerticalGrid.Accessibility;
using DevExpress.XtraTreeList.Printing;
using DevExpress.XtraTreeList.ViewInfo;
using DevExpress.XtraTreeList.Menu;
using DevExpress.XtraTreeList.Helpers;
using DevExpress.XtraTreeList.Handler;
using DevExpress.XtraTreeList.Painter;
using DevExpress.XtraTreeList.Data;
using DevExpress.XtraTreeList.StyleFormatConditions;
using DevExpress.XtraTreeList.Scrolling;
using DevExpress.XtraTreeList.Frames;
using DevExpress.XtraTreeList.Design;
using DevExpress.XtraTreeList.Localization;
using DevExpress.XtraTreeList.Internal;
using DevExpress.XtraTreeList.Columns;
using DevExpress.XtraTreeList.FilterEditor;
using DevExpress.XtraTreeList.Nodes.Operations;
using DevExpress.XtraTreeList.Native;
using DevExpress.XtraTreeList.Nodes;
using DevExpress.XtraTreeList.Dragging;
using DevExpress.XtraTreeList.Accessibility;
using DevExpress.XtraTreeList.Blending;
using DevExpress.XtraTreeList;
using DevExpress.XtraEditors.Controls.Rtf;
using DevExpress.XtraFilterEditor.IntelliSense;
using DevExpress.XtraFilterEditor;
using DevExpress.XtraRichEdit.Painters;
using DevExpress.XtraRichEdit.Forms.Design;
using DevExpress.XtraRichEdit.API.RichTextBox;
using DevExpress.XtraRichEdit.API.Word;
using DevExpress.API.Mso;
using DevExpress.XtraPrinting.Preview.Native.Galleries;
using DevExpress.XtraPrinting.Preview.Native;
using DevExpress.XtraPrinting.Links;
using DevExpress.XtraPrinting.Control;
using DevExpress.XtraPrinting.Control.Native;
using DevExpress.XtraPrinting.CodedUISupport;
using DevExpress.XtraPrinting.Native.WinControls;
using DevExpress.XtraLayout.Tab;
using DevExpress.XtraLayout.Scrolling;
using DevExpress.XtraLayout.Registrator;
using DevExpress.XtraLayout.Localization;
using DevExpress.XtraLayout.Converter;
using DevExpress.XtraLayout.Printing;
using DevExpress.XtraLayout.Dragging;
using DevExpress.XtraLayout.Diagnostics;
using DevExpress.XtraDataLayout;
using DevExpress.XtraLayout.Helpers;
using DevExpress.XtraDashboardLayout;
using DevExpress.XtraLayout.Customization.Controls;
using DevExpress.XtraLayout.Utils;
using DevExpress.XtraLayout.Accessibility;
using DevExpress.XtraLayout.ViewInfo;
using DevExpress.XtraLayout.Painting;
using DevExpress.XtraLayout.HitInfo;
using DevExpress.XtraLayout.Customization;
using DevExpress.XtraLayout.Resizing;
using DevExpress.XtraLayout;
using DevExpress.XtraLayout.Handlers;
using DevExpress.XtraLayout.Adapters;
using DevExpress.XtraGrid.Repository;
using DevExpress.XtraGrid.Tab;
using DevExpress.XtraGrid.Filter.Parser;
using DevExpress.XtraGrid.Menu;
using DevExpress.XtraGrid.Filter;
using DevExpress.XtraGrid.Printing;
using DevExpress.XtraGrid.Editors;
using DevExpress.XtraGrid.Frames;
using DevExpress.XtraGrid.Registrator;
using DevExpress.XtraGrid.Views.Layout.Printing;
using DevExpress.XtraGrid.Views.Layout.Drawing;
using DevExpress.XtraGrid.Views.Layout.Modes;
using DevExpress.XtraGrid.Views.Layout.Customization;
using DevExpress.XtraGrid.Views.Layout.Events;
using DevExpress.XtraGrid.Views.Layout.ViewInfo;
using DevExpress.XtraGrid.Views.Layout.Frames;
using DevExpress.XtraGrid.Views.Layout.Handler;
using DevExpress.XtraGrid.Views.Layout.Designer;
using DevExpress.XtraGrid.Views.Layout;
using DevExpress.XtraGrid.GroupSummaryEditor;
using DevExpress.XtraGrid.Localization;
using DevExpress.XtraGrid.Drawing;
using DevExpress.XtraGrid.Internal;
using DevExpress.XtraGrid.FilterEditor;
using DevExpress.XtraGrid.Export;
using DevExpress.XtraGrid.Views.Card.ViewInfo;
using DevExpress.XtraGrid.Views.Card.Drawing;
using DevExpress.XtraGrid.Views.Card.Handler;
using DevExpress.XtraGrid.Views.Card;
using DevExpress.XtraGrid.Design;
using DevExpress.XtraGrid.Blending;
using DevExpress.XtraGrid.Helpers;
using DevExpress.XtraGrid.Controls;
using DevExpress.XtraGrid.Views.Printing;
using DevExpress.XtraGrid.Scrolling;
using DevExpress.XtraGrid.Accessibility;
using DevExpress.XtraGrid.Views.BandedGrid.Customization;
using DevExpress.XtraGrid.Views.Grid.Customization;
using DevExpress.XtraGrid.Columns;
using DevExpress.XtraGrid.Skins;
using DevExpress.XtraGrid.Views.BandedGrid.ViewInfo;
using DevExpress.XtraGrid.Views.Grid.ViewInfo;
using DevExpress.XtraGrid.Views.Base.ViewInfo;
using DevExpress.XtraGrid.Views.BandedGrid.Drawing;
using DevExpress.XtraGrid.Views.Grid.Drawing;
using DevExpress.XtraGrid.Views.BandedGrid;
using DevExpress.XtraGrid.Views.Grid;
using DevExpress.XtraGrid.Views.Base;
using DevExpress.XtraGrid.Views.Base.Handler;
using DevExpress.XtraGrid.Views.Grid.Handler;
using DevExpress.XtraGrid.Views.BandedGrid.Handler;
using DevExpress.XtraGrid.Dragging;
using DevExpress.XtraEditors.FeatureBrowser;
using DevExpress.XtraTab.Buttons;
using DevExpress.XtraTab.Registrator;
using DevExpress.XtraTab.Drawing;
using DevExpress.XtraTab.ViewInfo;
using DevExpress.Accessibility.Tab;
using DevExpress.XtraWaitForm;
using DevExpress.XtraSplashForm;
using DevExpress.XtraSplashScreen;
using DevExpress.XtraEditors.Registrator;
using DevExpress.XtraEditors.Internal;
using DevExpress.XtraPivotGrid;
using DevExpress.XtraTab;
using DevExpress.XtraEditors.ColorPickEditControl;
using DevExpress.XtraEditors.Calendar;
using DevExpress.XtraEditors.NavigatorButtons;
using DevExpress.XtraEditors.Mask;
using DevExpress.XtraEditors.Popup;
using DevExpress.XtraEditors.Helpers;
using DevExpress.XtraEditors.Design;
using DevExpress.XtraEditors.Frames;
using DevExpress.XtraEditors.Customization;
using DevExpress.XtraEditors.ListControls;
using DevExpress.XtraEditors.Container;
using DevExpress.XtraEditors.CodedUISupport;
using DevExpress.XtraEditors.ButtonPanel;
using DevExpress.XtraEditors.Senders;
using DevExpress.XtraEditors.Persistent;
using DevExpress.XtraEditors.Repository;
using DevExpress.XtraBars.Ribbon.Customization;
using DevExpress.XtraBars.Docking.Controller;
using DevExpress.XtraBars.Docking2010.Dragging.WindowsUI;
using DevExpress.XtraBars.Docking2010.Views.NoDocuments;
using DevExpress.XtraBars.Docking2010.Views.NativeMdi;
using DevExpress.XtraBars.Docking2010.Views.WindowsUI;
using DevExpress.XtraBars.Commands.Internal;
using DevExpress.XtraBars.Commands.Ribbon;
using DevExpress.XtraBars.Commands;
using DevExpress.XtraBars.Commands.Design;
using DevExpress.XtraEditors.ColorPick.Popup.Galleries;
using DevExpress.XtraBars.ColorPick.Popup;
using DevExpress.XtraEditors.ColorPick.Picker;
using DevExpress.XtraBars.CodedUISupport;
using DevExpress.XtraBars.Editors;
using DevExpress.XtraTabbedMdi;
using DevExpress.XtraBars.Ribbon.Helpers;
using DevExpress.XtraBars.Ribbon.Internal;
using DevExpress.XtraBars.Ribbon.Gallery;
using DevExpress.XtraBars.Styles;
using DevExpress.XtraBars.Ribbon.Drawing;
using DevExpress.XtraBars.Ribbon.ViewInfo;
using DevExpress.XtraBars.Ribbon.Handler;
using DevExpress.XtraBars.Ribbon.Accessible;
using DevExpress.XtraBars.Localization;
using DevExpress.XtraBars.Design;
using DevExpress.XtraBars.Docking2010.Customization;
using DevExpress.XtraBars.InternalItems;
using DevExpress.XtraBars.Docking.Paint;
using DevExpress.XtraBars.Docking.Helpers;
using DevExpress.XtraBars.Docking;
using DevExpress.XtraBars.Docking2010.Dragging;
using DevExpress.XtraBars.Docking2010;
using DevExpress.XtraBars.Docking2010.DragEngine;
using DevExpress.XtraBars.Docking2010.Views.Tabbed;
using DevExpress.XtraBars.Docking2010.Views;
using DevExpress.XtraBars.Docking2010.Base;
using DevExpress.XtraBars.Ribbon;
using DevExpress.XtraBars.Customization.Helpers;
using DevExpress.XtraBars.Helpers.Docking;
using DevExpress.XtraBars.Forms;
using DevExpress.XtraBars.Registration;
using DevExpress.XtraBars.Helpers;
using DevExpress.XtraBars.ViewInfo;
using DevExpress.XtraBars.Objects;
using DevExpress.XtraBars.Native;
using DevExpress.XtraBars.MessageFilter;
using DevExpress.XtraBars.Painters;
using DevExpress.XtraBars.Utils;
using DevExpress.XtraBars;
using DevExpress.XtraBars.Controls;
using DevExpress.XtraBars.Alerter;
using DevExpress.XtraBars.Customization;
using DevExpress.XtraBars.Accessible;
using DevExpress.Utils.UI.Localization;
using DevExpress.Utils.UI;
using DevExpress.Utils.Frames;
using DevExpress.Utils.WXPaint;
using DevExpress.Utils.Mdi;
using DevExpress.Utils.Registrator;
using DevExpress.Utils.Native;
using DevExpress.Skins.Info;
using DevExpress.Skins.XtraForm;
using DevExpress.UserSkins;
using DevExpress.XtraReports.Serialization;
using DevExpress.XtraEditors.ViewInfo;
using DevExpress.Utils.NonclientArea;
using DevExpress.Utils.Drawing.Helpers;
using DevExpress.Utils.Helpers;
using DevExpress.Utils.Paint;
using DevExpress.LookAndFeel.Design;
using DevExpress.LookAndFeel.Helpers;
using DevExpress.Utils.Win.Hook;
using DevExpress.Utils.ViewInfo;
using DevExpress.Utils.ToolTip.ViewInfo;
using DevExpress.Utils.Extensions;
using DevExpress.XtraEditors.ScrollHelpers;
using DevExpress.Utils.Win;
using DevExpress.Utils.DragDrop;
using DevExpress.Skins;
using DevExpress.Utils.Gesture;
using DevExpress.Utils.Compress;
using DevExpress.Utils.CodedUISupport;
using DevExpress.Utils.Drawing;
using DevExpress.Utils.Drawing.Animation;
using DevExpress.Accessibility;
using DevExpress.LookAndFeel;
using DevExpress.XtraEditors.Drawing;
using DevExpress.XtraRichEdit.Internal.SimpleLayout;
using DevExpress.XtraRichEdit.Internal.ReadingLayout;
using DevExpress.XtraRichEdit.Internal.DraftLayout;
using DevExpress.XtraRichEdit.Internal.PrintLayout;
using DevExpress.XtraRichEdit.Design;
using DevExpress.XtraRichEdit.SyntaxEdit.Commands.Internal;
using DevExpress.XtraRichEdit.SyntaxEdit.Commands;
using DevExpress.XtraRichEdit.SyntaxEdit;
using DevExpress.XtraRichEdit.SyntaxEdit.Services.Implementation;
using DevExpress.XtraRichEdit.SpellChecker;
using DevExpress.XtraRichEdit.Services.Implementation;
using DevExpress.XtraRichEdit.Ruler;
using DevExpress.XtraPrinting.Native.RichText;
using DevExpress.XtraPrinting.Exports;
using DevExpress.XtraRichEdit.Printing;
using DevExpress.XtraRichEdit.Utils.NumberConverters;
using DevExpress.XtraRichEdit.Mouse;
using DevExpress.XtraRichEdit.Localization.Internal;
using DevExpress.XtraRichEdit.Localization;
using DevExpress.XtraRichEdit.Keyboard;
using DevExpress.XtraRichEdit.Design.Internal;
using DevExpress.XtraRichEdit.Menu;
using DevExpress.XtraRichEdit.Forms;
using DevExpress.XtraRichEdit.Fields.Expression;
using DevExpress.XtraRichEdit.Fields;
using DevExpress.XtraRichEdit.Model.History;
using DevExpress.XtraRichEdit.Layout.TableLayout;
using DevExpress.XtraRichEdit.Layout.Engine;
using DevExpress.XtraRichEdit.Layout.Export;
using DevExpress.XtraRichEdit.Import.Xaml;
using DevExpress.XtraRichEdit.Export.Xaml;
using DevExpress.XtraRichEdit.Import.WordML;
using DevExpress.XtraRichEdit.Export.WordML;
using DevExpress.XtraRichEdit.Import.Rtf.Tables;
using DevExpress.XtraRichEdit.Import.Rtf;
using DevExpress.XtraRichEdit.Export.PlainText;
using DevExpress.XtraRichEdit.Import.OpenXml;
using DevExpress.XtraRichEdit.Export.OpenXml;
using DevExpress.XtraRichEdit.Import.OpenDocument;
using DevExpress.XtraRichEdit.Export.OpenDocument;
using DevExpress.XtraRichEdit.Import.Mht;
using DevExpress.XtraRichEdit.Export.Mht;
using DevExpress.XtraRichEdit.Import.Html;
using DevExpress.XtraRichEdit.Import.EPub;
using DevExpress.XtraRichEdit.Export.Html;
using DevExpress.XtraRichEdit.Export.EPub;
using DevExpress.XtraRichEdit.Services;
using DevExpress.XtraRichEdit.Import;
using DevExpress.XtraRichEdit.Import.Doc;
using DevExpress.XtraRichEdit.Tables.Native;
using DevExpress.XtraRichEdit.Export.Doc;
using DevExpress.XtraRichEdit.Native;
using DevExpress.XtraRichEdit.Export;
using DevExpress.XtraRichEdit.Utils;
using DevExpress.XtraRichEdit.Commands.Helper;
using DevExpress.XtraRichEdit.Commands.Internal;
using DevExpress.XtraRichEdit.Commands;
using DevExpress.XtraRichEdit.Drawing;
using DevExpress.XtraRichEdit.Layout;
using DevExpress.XtraRichEdit.Internal;
using DevExpress.XtraRichEdit.API.Native.Implementation;
using DevExpress.XtraRichEdit.API.Native;
using DevExpress.XtraRichEdit.API.Internal;
using DevExpress.XtraRichEdit.Model;
using DevExpress.Printing.ServiceModel.DataContracts;
using DevExpress.Xpf.Printing.ServiceModel.DataContracts;
using DevExpress.XtraReports.ServiceModel.DataContracts;
using DevExpress.XtraPrinting.Drawing;
using DevExpress.XtraPrinting.Preview;
using DevExpress.Printing;
using DevExpress.XtraReports;
using DevExpress.XtraPrinting.InternalAccess;
using DevExpress.XtraPrinting.Export.Pdf.Compression;
using System.Collections;
using DevExpress.XtraPrinting.Native.LayoutAdjustment;
using DevExpress.XtraPrinting.Native.TextRotation;
using DevExpress.XtraPrinting.Native.Navigation;
using DevExpress.XtraPrinting.Native.Lines;
using DevExpress.XtraPrinting.HtmlExport;
using DevExpress.XtraPrinting.HtmlExport.Native;
using DevExpress.XtraPrinting.Export.XLS;
using DevExpress.XtraPrinting.Export.Text;
using DevExpress.XtraPrinting.Export.Rtf;
using DevExpress.XtraPrinting.Export.Imaging;
using DevExpress.XtraPrinting.Native.ExportOtions;
using DevExpress.XtraPrinting.Native.ExportOptionsControllers;
using DevExpress.XtraPrinting.Shape;
using DevExpress.XtraPrinting.Shape.Native;
using DevExpress.XtraPrinting.NativeBricks;
using DevExpress.XtraPrinting.Export.Pdf;
using DevExpress.XtraPrinting.Export;
using DevExpress.Printing.Core.Native;
using DevExpress.Printing.Core;
using DevExpress.XtraPrintingLinks;
using DevExpress.Printing.Core.HtmlExport;
using DevExpress.XtraPrinting.Export.Web;
using DevExpress.XtraPrinting.HtmlExport.Controls;
using DevExpress.XtraPrinting.BarCode.Native;
using DevExpress.XtraPrinting.BarCode;
using DevExpress.XtraPrinting.BrickExporters;
using DevExpress.Office.Services;
using DevExpress.Office.Services.Implementation;
using DevExpress.Office.Layout.Export;
using DevExpress.Office.Printing;
using DevExpress.Office.PInvoke;
using DevExpress.Office.Localization.Internal;
using DevExpress.Office.Localization;
using DevExpress.Office.Drawing;
using DevExpress.XtraRichEdit;
using DevExpress.Office.History;
using DevExpress.Office.Model;
using DevExpress.Office.Layout;
using DevExpress.Utils.StructuredStorage.Writer;
using DevExpress.Utils.StructuredStorage.Internal.Writer;
using DevExpress.Utils.StructuredStorage.Internal.Reader;
using DevExpress.Utils.StructuredStorage.Reader;
using DevExpress.Utils.StructuredStorage.Internal;
using DevExpress.Office.Utils;
using DevExpress.Office.Import;
using DevExpress.Office.Export;
using DevExpress.Office;
using DevExpress.Office.Internal;
using DevExpress.Office.API.Internal;
using DevExpress.Data.XtraReports.Wizard.Views;
using DevExpress.Data.XtraReports.Wizard.Presenters;
using DevExpress.Utils.Implementation;
using DevExpress.Data.Summary;
using DevExpress.Data.Async.Helpers;
using DevExpress.Schedule.Serializing;
using DevExpress.Schedule;
using DevExpress.Utils.Text.Internal;
using DevExpress.Data.Async;
using DevExpress.Data.Printing.Native;
using DevExpress.Utils.Zip;
using DevExpress.XtraPrinting.Localization;
using DevExpress.XtraPrinting.DataNodes;
using DevExpress.Data.ChartDataSources;
using DevExpress.Charts.Native;
using DevExpress.Xpo.Logger.Transport;
using DevExpress.Xpo.Logger;
using DevExpress.Utils.Text;
using DevExpress.XtraEditors.Filtering;
using DevExpress.XtraEditors;
using DevExpress.Data.ExpressionEditor;
using DevExpress.XtraExport;
using DevExpress.Data.Linq.Helpers;
using DevExpress.Data.Linq;
using DevExpress.Utils.Internal;
using DevExpress.Xpo.Providers;
using DevExpress.Data.Db;
using DevExpress.Data.Design;
using DevExpress.Xpo.XtraData;
using DevExpress.Data.Utils.ServiceModel.Native;
using DevExpress.CodeParser;
using DevExpress.XtraEditors.Controls;
using DevExpress.XtraEditors.DXErrorProvider;
using DevExpress.XtraPrinting;
using DevExpress.Internal;
using DevExpress.XtraPrinting.Design;
using DevExpress.Utils.Serializing.Helpers;
using DevExpress.Utils.Editors;
using DevExpress.Utils.Localization.Internal;
using DevExpress.Utils.Localization;
using DevExpress.Data.Utils;
using DevExpress.Utils.Serializing;
using DevExpress.WebUtils;
using DevExpress.Utils.Controls;
using DevExpress.Data.IO;
using DevExpress.XtraSpellChecker.Native;
using DevExpress.XtraSpellChecker.Parser;
using DevExpress.XtraSpellChecker;
using DevExpress.Services.Implementation;
using DevExpress.Services;
using DevExpress.XtraRichEdit.Export.Rtf;
using DevExpress.Data.Mask;
using DevExpress.Utils.KeyboardHandler;
using DevExpress.Utils.Design;
using DevExpress.Data.XtraReports.Wizard.Native;
using DevExpress.Data.XtraReports.Wizard;
using DevExpress.Data.XtraReports.ServiceModel.DataContracts;
using DevExpress.Data.XtraReports.ServiceModel;
using DevExpress.XtraReports.Parameters;
using DevExpress.Data.XtraReports.Native;
using DevExpress.Data.XtraReports.Labels;
using DevExpress.Data.XtraReports.DataProviders;
using DevExpress.XtraReports.Design.Commands;
using DevExpress.XtraReports.UserDesigner;
using DevExpress.XtraReports.Native.Parameters;
using DevExpress.XtraReports.UI;
using DevExpress.Data.WizardFramework;
using DevExpress.Utils.About;
using DevExpress.Data.Utils.ServiceModel;
using DevExpress.Utils.IoC;
using DevExpress.Xpf.Printing;
using DevExpress.XtraPrinting.Native;
using DevExpress.Utils.OAuth.Provider;
using DevExpress.Utils.OAuth;
using DevExpress.Utils.Gac;
using DevExpress.XtraGrid;
using DevExpress.Data.Filtering.Exceptions;
using DevExpress.Xpo;
using DevExpress.Utils.Extensions.Helpers;
using DevExpress.Data.Details;
using DevExpress.Xpo.Exceptions;
using DevExpress.Xpo.DB.Exceptions;
using DevExpress.Xpo.Helpers;
using DevExpress.Xpo.DB;
using DevExpress.Xpo.DB.Helpers;
using DevExpress.Data.Storage;
using DevExpress.Data.Access;
using DevExpress.Utils.Menu;
using DevExpress.Utils.Commands;
using DevExpress.Data.Filtering;
using DevExpress.Data.Helpers;
using DevExpress.Data.Selection;
using DevExpress.XtraReports.Native;
using DevExpress.XtraReports.Native.Data;
using DevExpress.Data.Browsing.Design;
using DevExpress.XtraReports.Design;
using DevExpress.Data;
using DevExpress.Services.Internal;
using DevExpress.Data.Browsing;
using DevExpress.Data.Filtering.Helpers;
using DevExpress.Data.Native;
using DevExpress.Utils;
using Cryptdll.classi;
using Cryptdll;
using MRG.Controls.UI;
using CLFtp;
#region Default Usings...
using BusinessObjects.ERP.Variants.Documents.Variants;
using BusinessObjects.ERP.BillOfMaterials.Documents.BOMNavigation;
using BusinessObjects.Doors.Doors.DynamicDocuments.Configurazioni;
using Microarea.Library.WCFGeneratedFunctions;
using System.Collections.Generic;
using System.Data.Common;
using System.Data.SqlClient;
using System.Data.OleDb;
using Microarea.EasyBuilder;
using Microarea.EasyBuilder.MVC;
using Microarea.TaskBuilderNet.UI.WinControls;
using Microarea.TaskBuilderNet.Interfaces.View;
using Microarea.TaskBuilderNet.Interfaces;
using Microarea.TaskBuilderNet.Core.CoreTypes;
using Microarea.TaskBuilderNet.Core.EasyBuilder;
using Microarea.TaskBuilderNet.Core.Generic;
using Microarea.Framework.TBApplicationWrapper;
using Microarea.TaskBuilderNet.Interfaces.Model;
using System.ComponentModel;
using System.Windows.Forms;
using System.Xml;
using System.Drawing;
using System.Data;
using System;
//using BusinessObjects.Doors.Doors.DynamicDocuments.DoorsConf;
//using BusinessObjects.Doors.Doors.DynamicDocuments.ConfiguratoreDoors;
#endregion
namespace Customization.ERP.SaleOrders.Documents.SaleOrd.SaleOrd
{
	
	public class RowState
	{
		public bool IsActive { get; set; }
		public string ItemRow { get; set; }
		public string VariantRow { get; set; }
	}
	
	public partial class DocumentController
	{
		public void Document_DBTSaleOrder_Queried(Object sender, EasyBuilderEventArgs e)
		{
			try
			{
				//Write your code between here
				if(Document.DBTSaleOrder.TMA_SaleOrd.fld_Priority.Value == 2)
				{
					Document.DBTSaleOrder.TMA_SaleOrd.fld_StatoOrdineDoors.Value= "Rifiutato";
					Document.DBTSaleOrder.TMA_SaleOrd.fld_StatoOrdineDoors.FireValueChanged();
				}
				if(Document.DBTSaleOrder.TMA_SaleOrd.fld_Priority.Value == 3)
					Document.DBTSaleOrder.TMA_SaleOrd.fld_StatoOrdineDoors.Value = "Confermato";
				if(Document.DBTSaleOrder.TMA_SaleOrd.fld_Priority.Value == 0)
					Document.DBTSaleOrder.TMA_SaleOrd.fld_StatoOrdineDoors.Value= "Preventivo";
				
				Document.UpdateDataView();
				
				//and here
			}
			catch (System.Exception exc)
			{
				this.OnExceptionRaised(exc);
			}
		}

		public void tile_CustomerData_ctrl_MParsedCombo_ValueChanged(Object sender, EasyBuilderEventArgs e)
		{
			try
			{
				//Write your code between here
				if(Document.FormMode == FormModeType.Edit || Document.FormMode == FormModeType.New)
				{
					//Write your code between here
					if(view_SaleOrd.tileGroup_HeaderData.tile_CustomerData.ctrl_MParsedCombo.Text == "Rifiutato")
					{
						Document.DBTSaleOrder.TMA_SaleOrd.fld_Priority.Value = 2;
						Document.DBTSaleOrder.TMA_SaleOrd.fld_Priority.FireValueChanged();
					}
					if(view_SaleOrd.tileGroup_HeaderData.tile_CustomerData.ctrl_MParsedCombo.Text == "Confermato")
					{
						Document.DBTSaleOrder.TMA_SaleOrd.fld_Priority.Value = 3;
						Document.DBTSaleOrder.TMA_SaleOrd.fld_Priority.FireValueChanged();
					}
					if(view_SaleOrd.tileGroup_HeaderData.tile_CustomerData.ctrl_MParsedCombo.Text == "Preventivo")
					{
						Document.DBTSaleOrder.TMA_SaleOrd.fld_Priority.Value = 0;
						Document.DBTSaleOrder.TMA_SaleOrd.fld_Priority.FireValueChanged();
					}
				}
				//and here
			}
			catch (System.Exception exc)
			{
				this.OnExceptionRaised(exc);
			}
		}

		public void tile_CustomerData_ctrl_MParsedCombo_SelectedIndexChanged(Object sender, EasyBuilderEventArgs e)
		{
			try
			{
				
				
				
				
				
				//and here
			}
			catch (System.Exception exc)
			{
				this.OnExceptionRaised(exc);
			}
		}


		public void ctrl_BEDetail_col_Item_ValueChanged(Object sender, EasyBuilderEventArgs e)
		{
			try
			{
				if(Document.FormMode==FormModeType.New || Document.FormMode==FormModeType.Edit)
				{
					TDBTDetail_MA_SaleOrdDetails riga = Document.DBTDetail.GetCurrentRow();
					if(riga.fld_Item.Value != "")
					{
						//leggo le dimensioni nominali solo se non provengo da una configurazione
						if(riga.fld_Variant.Value == string.Empty)
						{
							//ricerco i dati articolo
							Document.DMItems.FilterQuery = "Item = '" + riga.fld_Item.Value + "'";
							if(Document.DMItems.Read()==MDataManager.ReadResult.Found)
							{
								Document.DBTDetail.CastToMyRecord(riga).fld_DoorsAltezza.Value = Document.DMItems.TMA_Items.fld_DoorsHNominale.Value + (Document.DMItems.TMA_Items.fld_DoorsCoeffH.Value * -1);
								Document.DBTDetail.CastToMyRecord(riga).fld_DoorsLarghezza.Value = Document.DMItems.TMA_Items.fld_DoorsLNominale.Value +  (Document.DMItems.TMA_Items.fld_DoorsCoeffL.Value * -1) ;
								Document.DBTDetail.CastToMyRecord(riga).fld_DoorsSpMuro.Value = Document.DMItems.TMA_Items.fld_DoorsPNominale.Value + (Document.DMItems.TMA_Items.fld_DoorsCoeffP.Value * -1);
							}
							Document.DMItems.Close();
							
							//calcolo prezzi/assegno sconti
							TDBTDetail_MA_SaleOrdDetails rigaConPrezzi = calcolaPrezzo(riga, false); //false perchè non deve gestire le maggiorazioni
							riga.fld_UnitValue.FireValueChanged();
							//assegno i dati
							Document.DBTDetail.CastToMyRecord(riga).fld_DoorsPrezzoBase.Value = rigaConPrezzi.fld_DoorsPrezzoBase.Value;
							Document.DBTDetail.CastToMyRecord(riga).fld_DoorsSC1PB.Value = rigaConPrezzi.fld_DoorsSC1PB.Value;
							Document.DBTDetail.CastToMyRecord(riga).fld_DoorsSC2PB.Value = rigaConPrezzi.fld_DoorsSC2PB.Value;
							Document.DBTDetail.CastToMyRecord(riga).fld_DoorsSC3PB.Value = rigaConPrezzi.fld_DoorsSC3PB.Value;
							//
						}
						
					}
					else
					{
						Document.DBTDetail.CastToMyRecord(riga).fld_DoorsAltezza.Value = 0;
						Document.DBTDetail.CastToMyRecord(riga).fld_DoorsLarghezza.Value = 0;
						Document.DBTDetail.CastToMyRecord(riga).fld_DoorsSpMuro.Value = 0;
					}
				}
			}
			catch (System.Exception exc)
			{
				this.OnExceptionRaised(exc);
			}
		}

		public void tile_Detail_ctrl_MPushButtonDetMagg_Click(Object sender, EasyBuilderEventArgs e)
		{
			try
			{
				var testriga = CheckRowState();
				bool editconfig = false;
				if(!testriga.IsActive)
				{
					MessageBox.Show("Seleziona una riga", "Doors", MessageBoxButtons.OK, MessageBoxIcon.Information);
					return;
				}
				
				TDBTDetail_MA_SaleOrdDetails rigacorr = Document.DBTDetail.GetCurrentRow();
				
				//cerco il codice categoria di tipo porte
				string mCatPorte = "";
				if(Document.DMDOORSParams.Read()==MDataManager.ReadResult.Found)
				{
					mCatPorte = Document.DMDOORSParams.TTAG_DOORS_Params.fld_CatMercPorte.Value;
				}
				Document.DMDOORSParams.Close();
				
				//se non è specificato l'articolo segnalo l'errore
				if(rigacorr.fld_Item.Value == "")
				{
					MessageBox.Show("Bisogna specificare il codice articolo!", "Doors", MessageBoxButtons.OK, MessageBoxIcon.Information);
					return;
				}
				
				//cerco la categoria merceologica articolo selezionato
				Document.DMItems.FilterQuery = "Item = '" + rigacorr.fld_Item.Value + "'";
				if(Document.DMItems.Read()==MDataManager.ReadResult.Found)
				{
					if(Document.DMItems.TMA_Items.fld_CommodityCtg.Value != mCatPorte)
					{
						MessageBox.Show("L'articolo selezionato non è una porta", "Doors", MessageBoxButtons.OK, MessageBoxIcon.Information);
						return;
					}
				}
				Document.DMItems.Close();
				//
				
				var ModMagg = new DoorsAddoOnLibrary.ModConf();
				var conn = CUtility.OpenConnectionToCurrentCompany();
				//la passo chiusa perchè il form la riapre
				conn.Close();
				ModMagg.connMago = conn;
				//
				
				//assegno prezzo base
				ModMagg.dConf.PrezzoBase = rigacorr.fld_DoorsPrezzoBase.Value;
				
				//cerco i dati articolo per cercare i dati maggiorazioni
				string mRicMagg = "";
				Document.DMItems.FilterQuery = "Item = '" + rigacorr.fld_Item.Value + "'";
				if(Document.DMItems.Read()==MDataManager.ReadResult.Found)
				{
					ModMagg.dConf.CtgProd = Document.DMItems.TMA_Items.fld_ProductCtg.Value;
					ModMagg.dConf.SubCtgProd = Document.DMItems.TMA_Items.fld_ProductSubCtg.Value;
					
					mRicMagg = "Prodctg = '" + Document.DMItems.TMA_Items.fld_ProductCtg.Value + "' AND ProdSubCtg = '" + Document.DMItems.TMA_Items.fld_ProductSubCtg.Value + "'";
					//
				}
				Document.DMItems.Close();
				
				//cerco prima con il codice cliente
				bool mRicTutti = true;
				Document.DMDOORSMaggiorazioni.FilterQuery= mRicMagg + " AND Customer = '" + Document.DBTSaleOrder.TMA_SaleOrd.fld_Customer.Value + "'";
				if(Document.DMDOORSMaggiorazioni.Read()==MDataManager.ReadResult.Found)
				{
					mRicTutti = false;
					ModMagg.dConf.Customer = Document.DBTSaleOrder.TMA_SaleOrd.fld_Customer.Value;
				}
				Document.DMDOORSMaggiorazioni.Close();
				
				if(mRicTutti)
				{
					ModMagg.dConf.Customer = "*";
				}
				
				ModMagg.dConf.Item = rigacorr.fld_Item.Value;
				ModMagg.dConf.Variante = rigacorr.fld_Variant.Value;
				ModMagg.dConf.Altezza = rigacorr.fld_DoorsAltezza.Value;
				ModMagg.dConf.Larghezza = rigacorr.fld_DoorsLarghezza.Value;
				ModMagg.dConf.Spessore = rigacorr.fld_DoorsSpMuro.Value;
				ModMagg.dConf.Descrizione = rigacorr.fld_Description.Value;
				ModMagg.dConf.Maggiorazione = rigacorr.fld_DoorsMaggiorazione.Value;
				ModMagg.dConf.UnitValue = rigacorr.fld_UnitValue.Value;
				ModMagg.dConf.SaleOrdiId = Document.DBTSaleOrder.TMA_SaleOrd.fld_SaleOrdId.Value;
				ModMagg.dConf.SaleOrdLine = rigacorr.fld_Line.Value;
				ModMagg.dConf.ScontoMagg1 = rigacorr.fld_DoorsSC1Magg.Value;
				ModMagg.dConf.ScontoMagg2 = rigacorr.fld_DoorsSC2Magg.Value;
				ModMagg.dConf.ScontoMagg3 = rigacorr.fld_DoorsSC3Magg.Value;
				ModMagg.dConf.ScontoPB1 = rigacorr.fld_DoorsSC1PB.Value;
				ModMagg.dConf.ScontoPB2 = rigacorr.fld_DoorsSC2PB.Value;
				ModMagg.dConf.ScontoPB3 = rigacorr.fld_DoorsSC3PB.Value;
				ModMagg.dConf.Provvigione = rigacorr.fld_CommPerc.Value;

				List<MaggiorazioneRigaOrd> mRighe = new List<MaggiorazioneRigaOrd>();
				
				string mCodConf = "";
				
				if(rigacorr.fld_Variant.Value!="")
				{
					mCodConf = rigacorr.fld_Variant.Value.ToString().Substring(0,6);
				}
				Document.DMDOORSConfigMagg.FilterQuery = "IdGuid ='" + mCodConf + "'"; // AND Line = " + rigacorr.fld_Line.Value.ToString();
				while(Document.DMDOORSConfigMagg.Read()==MDataManager.ReadResult.Found)
				{
					var rigamagg = new DoorsAddoOnLibrary.MaggiorazioneRigaOrd();
					rigamagg.ADim = Document.DMDOORSConfigMagg.TTAG_DOORS_ConfigMagg.fld_ADim.Value;
					rigamagg.DaDim = Document.DMDOORSConfigMagg.TTAG_DOORS_ConfigMagg.fld_DaDim.Value;
					rigamagg.CtgProd = Document.DMDOORSConfigMagg.TTAG_DOORS_ConfigMagg.fld_CtgProd.Value;
					rigamagg.Customer = Document.DMDOORSConfigMagg.TTAG_DOORS_ConfigMagg.fld_Customer.Value;
					rigamagg.Descrizione = Document.DMDOORSConfigMagg.TTAG_DOORS_ConfigMagg.fld_Descrizione.Value;
					rigamagg.Dimenzione = Document.DMDOORSConfigMagg.TTAG_DOORS_ConfigMagg.fld_Dimensione.Value;
					rigamagg.IdGuid = Document.DMDOORSConfigMagg.TTAG_DOORS_ConfigMagg.fld_IdGuid.Value;
					rigamagg.Item = Document.DMDOORSConfigMagg.TTAG_DOORS_ConfigMagg.fld_Item.Value;
					//cerco la descrizione articolo
					Document.DMItems.FilterQuery = "Item = '" + Document.DMDOORSConfigMagg.TTAG_DOORS_ConfigMagg.fld_Item.Value + "'";
					if(Document.DMItems.Read()==MDataManager.ReadResult.Found)
					{
						rigamagg.Item += " - " + Document.DMItems.TMA_Items.fld_Description.Value;
					}
					Document.DMItems.Close();
					//
					rigamagg.Line = Document.DMDOORSConfigMagg.TTAG_DOORS_ConfigMagg.fld_Line.Value;
					rigamagg.OltreStandard = Document.DMDOORSConfigMagg.TTAG_DOORS_ConfigMagg.fld_OltreStandard.Value;
					rigamagg.Importo = Document.DMDOORSConfigMagg.TTAG_DOORS_ConfigMagg.fld_Importo.Value;
					rigamagg.TipoMaggiorazione = Document.DMDOORSConfigMagg.TTAG_DOORS_ConfigMagg.fld_TipoMaggiorazione.Value;
					rigamagg.Apertura = Document.DMDOORSConfigMagg.TTAG_DOORS_ConfigMagg.fld_Apertura.Value;
					//cerco la descrizione apertura
					Document.DMDOORSAperture.FilterQuery = "CodiceAp = '" + Document.DMDOORSConfigMagg.TTAG_DOORS_ConfigMagg.fld_Apertura.Value + "'";
					if(Document.DMDOORSAperture.Read()==MDataManager.ReadResult.Found)
					{
						rigamagg.Apertura += " - " + Document.DMDOORSAperture.TTAG_DOORS_Aperture.fld_Descrizione.Value;
					}
					Document.DMDOORSAperture.Close();
					//
					mRighe.Add(rigamagg);
				}
				Document.DMDOORSConfigMagg.Close();
				
				ModMagg.dConf.Maggiorazioni = mRighe;
				
				if(ModMagg.ShowDialog() == DialogResult.Yes && ModMagg.dConf.ModificheRiga)
				{
					//aggiorna riga
					Document.DBTDetail.CastToMyRecord(rigacorr).fld_UnitValue.Value = ModMagg.dConf.UnitValue;
					Document.DBTDetail.CastToMyRecord(rigacorr).fld_UnitValue.FireValueChanged();
					Document.DBTDetail.CastToMyRecord(rigacorr).fld_DoorsMaggiorazione.Value = ModMagg.dConf.Maggiorazione;
					Document.DBTDetail.CastToMyRecord(rigacorr).fld_DoorsSC1Magg.Value = ModMagg.dConf.ScontoMagg1;
					Document.DBTDetail.CastToMyRecord(rigacorr).fld_DoorsSC2Magg.Value = ModMagg.dConf.ScontoMagg2;
					Document.DBTDetail.CastToMyRecord(rigacorr).fld_DoorsSC3Magg.Value = ModMagg.dConf.ScontoMagg3;
					Document.DBTDetail.CastToMyRecord(rigacorr).fld_DoorsSC1PB.Value = ModMagg.dConf.ScontoPB1;
					Document.DBTDetail.CastToMyRecord(rigacorr).fld_DoorsSC2PB.Value = ModMagg.dConf.ScontoPB2;
					Document.DBTDetail.CastToMyRecord(rigacorr).fld_DoorsSC3PB.Value = ModMagg.dConf.ScontoPB3;
					Document.DBTDetail.CastToMyRecord(rigacorr).fld_CommPercAuto.Value = false;
					Document.DBTDetail.CastToMyRecord(rigacorr).fld_CommPercAuto.FireValueChanged();
					Document.DBTDetail.CastToMyRecord(rigacorr).fld_CommPerc.Value = ModMagg.dConf.Provvigione;
					Document.DBTDetail.CastToMyRecord(rigacorr).fld_CommPerc.FireValueChanged();
					Document.DBTDetail.Modified = true;

					//aggiorno i dati corpo
					this.view_SaleOrd.tileManager_SaleOrdTileMng.tileGroup_MainData.tile_Detail.ctrl_BEDetail.Enabled = false;
					this.view_SaleOrd.tileManager_SaleOrdTileMng.tileGroup_MainData.tile_Detail.ctrl_BEDetail.Enabled = true;
					Document.UpdateDataView();
					
					if(ModMagg.dConf.ModificheConfigurazione)
					{
						//assegno flag in caso modifiche alla configurazione
						Document.DBTSaleOrder.TMA_SaleOrd.fld_ModificheConf.Value = true;
					}
				}
				
				ModMagg.Close();
				ModMagg.Dispose();
			}
			catch (System.Exception exc)
			{
				this.OnExceptionRaised(exc);
			}
		}

		public void DocumentController_ExtraTransacted(Object sender, TransactionEventArgs e)
		{
			try
			{
				//assegno l'id ordine e la riga alle configurazioni generate
				if(Document.FormMode == FormModeType.New || Document.FormMode == FormModeType.Edit)
				{
					//invoco la business object configurazioni
					MDConfigurazioni conf = MDConfigurazioni.CreateUnattended(null);
					
					int rc = Document.DBTDetail.RowsCount;
					for(int i=0; i<rc; i++)
					{
						TDBTDetail_MA_SaleOrdDetails riga = Document.DBTDetail.GetRow(i);
						if(riga.fld_LineType.Value == Enums.Line_Type.Goods && !string.IsNullOrEmpty(riga.fld_Variant.Value))
						{
							string mCodConf = riga.fld_Variant.Value.ToString().Substring(0,6);
							if(mCodConf!="") //assegno i dati ordine
							{
								conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_IdGuid.Value = mCodConf;
								conf.BrowseRecord();
								if(conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_SaleOrdId.Value == 0) //assegno i dati solo se non assegnati in precedenza
								{
									conf.EditCurrentRecord();
									conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_SaleOrdId.Value = Document.DBTSaleOrder.TMA_SaleOrd.fld_SaleOrdId.Value;
									conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_LineSaleOrd.Value = riga.fld_Line.Value;
									conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_PositionSaleOrd.Value = riga.fld_Position.Value;
									conf.SaveCurrentRecord();
								}
							}
						}
					}
					conf.Close();
				}
			}
			catch (System.Exception exc)
			{
				this.OnExceptionRaised(exc);
			}
		}

		public void TMA_SaleOrdDetails_fld_Item_ValueChanged(Object sender, EasyBuilderEventArgs e)
		{
			try
			{
				if(Document.FormMode == FormModeType.New || Document.FormMode == FormModeType.Edit)
				{
					//Write your code between here
					var riga = Document.DBTDetail.GetCurrentRow();
					//var item = riga.fld_Item.Value;
					
					//leggo le dimensioni nominali solo se non provengo da una configurazione
					if(riga.fld_Variant.Value == string.Empty)
					{
						Document.DMItems.FilterQuery =
							"Item = '" + riga.fld_Item.Value + "'";
						
						while(Document.DMItems.Read() == MDataManager.ReadResult.Found)
						{
							riga.fld_DoorsAltezza.Value = Document.DMItems.TMA_Items.fld_DoorsHNominale.Value;
							riga.fld_DoorsLarghezza.Value = Document.DMItems.TMA_Items.fld_DoorsLNominale.Value;
							riga.fld_DoorsSpMuro.Value = Document.DMItems.TMA_Items.fld_DoorsPNominale.Value;
						}
						Document.DMItems.Close();
					}
					Document.UpdateDataView();
				}
				
				//and here
			}
			catch (System.Exception exc)
			{
				this.OnExceptionRaised(exc);
			}
		}

		public void tile_Detail_ctrl_MPushButtonNavGraf_Click(Object sender, EasyBuilderEventArgs e)
		{
			try
			{
				//Write your code between here
				var testriga = CheckRowState();
				if(!testriga.IsActive)
				{
					MessageBox.Show("Seleziona una riga");
					return;
				}
				else
				{
					var riga = Document.DBTDetail.GetCurrentRow();
					var nav = MDBOMNavigation.Create();
					nav.fld_BOM.Value = riga.fld_Item.Value;
					nav.fld_BOM.FireValueChanged();
					nav.fld_Variant.Value = riga.fld_Variant.Value;
					nav.fld_Variant.FireValueChanged();
					nav.UpdateDataView();
				}
				
				//and here
			}
			catch (System.Exception exc)
			{
				this.OnExceptionRaised(exc);
			}
		}

		public void DocumentController_ControlsEnabled(Object sender, ControllerEventArgs e)
		{
			try
			{
				view_SaleOrd.tileManager_SaleOrdTileMng.tileGroup_MainData.tile_Detail.ctrl_MPushButtonNavGraf.Enabled = true;
				//Write your code between here
				view_SaleOrd.tileManager_SaleOrdTileMng.tileGroup_MainData.tile_Detail.ctrl_MPushButton2.Enabled = true;
				view_SaleOrd.tileManager_SaleOrdTileMng.tileGroup_MainData.tile_Detail.ctrl_MPushButtonDetMagg.Enabled = true;
				view_SaleOrd.tileGroup_HeaderData.tile_CustomerData.ctrl_MParsedCombo.Enabled = true;
				//and here
			}
			catch (System.Exception exc)
			{
				this.OnExceptionRaised(exc);
			}
		}

		public void DocumentController_EnteredInBrowse(Object sender, ControllerEventArgs e)
		{
			try
			{
				//Write your code between here
				view_SaleOrd.tileManager_SaleOrdTileMng.tileGroup_MainData.tile_Detail.ctrl_MPushButton2.Enabled = false;
				view_SaleOrd.tileManager_SaleOrdTileMng.tileGroup_MainData.tile_Detail.ctrl_MPushButtonNavGraf.Enabled = false;
				view_SaleOrd.tileManager_SaleOrdTileMng.tileGroup_MainData.tile_Detail.ctrl_MPushButtonDetMagg.Enabled = false;
				view_SaleOrd.tileGroup_HeaderData.tile_CustomerData.ctrl_MParsedCombo.Enabled = false;
				//and here
			}
			catch (System.Exception exc)
			{
				this.OnExceptionRaised(exc);
			}
		}

		

		public void tile_Detail_ctrl_MPushButton2_Click(Object sender, EasyBuilderEventArgs e)
		{
			try
			{
				//Write your code between here
				tile_DocumentData_ctrl_MPushButton_Click(sender, e);
				//and here
			}
			catch (System.Exception exc)
			{
				this.OnExceptionRaised(exc);
			}
		}

		
		public HubConnection hubConnection { get; set; }
		public const string ServerUrl = "http://localhost:57204";
		
		public void tile_DocumentData_ctrl_MPushButton1_Click(Object sender, EasyBuilderEventArgs e)
		{
			try
			{
				Connect();
				
				//and here
			}
			catch (System.Exception exc)
			{
				this.OnExceptionRaised(exc);
			}
		}
		
		public async void Connect()
		{
			//Write your code between here
			
			try
			{
				hubConnection = new HubConnectionBuilder()
					.WithUrl(ServerUrl + "/chathub")
					.Build();
				
				hubConnection.On<string, string>("ReceiveMessage", (user, message) =>
				                                 {
				                                 	
				                                 	TDBTDetail_MA_SaleOrdDetails riga = Document.DBTDetail.GetCurrentRow();
				                                 	Document.DBTDetail.CastToMyRecord(riga).fld_Variant.Value = message;
				                                 	Document.DBTDetail.CastToMyRecord(riga).fld_Variant.FireValueChanged();

				                                 });
				await hubConnection.StartAsync();
			}
			catch (System.Exception exc)
			{
				MessageBox.Show(exc.Message);
			}
			
		}
		

		
		private RowState CheckRowState()
		{
			var rs = new RowState();
			var riga = Document.DBTDetail.GetCurrentRow();
			if(riga == null)
				rs.IsActive = false;
			else
			{
				rs.IsActive = true;
				rs.ItemRow = riga.fld_Item.Value;
				rs.VariantRow = riga.fld_Variant.Value;
				
			}
			return rs;
			
			
		}


		public void tile_DocumentData_ctrl_MPushButton_Click(Object sender, EasyBuilderEventArgs e)
		{
			try
			{
				var testriga = CheckRowState();
				
				bool editconfig = false;
				
				if(!testriga.IsActive)
				{
					MessageBox.Show("Seleziona una riga");
					return;
				}
				else
				{
					if(!string.IsNullOrEmpty(testriga.ItemRow) && !string.IsNullOrEmpty(testriga.VariantRow))
					{
						editconfig = true;
						MessageBox.Show("Stai richiamando una configurazione al momento è un'operazione non gestita. Cancella il rigo ordine e rifai la configurazione ");
						return;
					}
				}
				
				//Write your code between here
				var MyConf = new DoorsAddoOnLibrary.Configuratore();
				var conn = CUtility.OpenConnectionToCurrentCompany();
				//la passo chiusa perchè il form la riapre
				conn.Close();
				MyConf.SetDbConnection(conn);
				
				if(editconfig)
				{
					//ricavare il codice
					string codtoedit = "";
					var infovar =  testriga.VariantRow.Right(4);
					if(infovar == "/000")
					{
						//non è una variante standard
						//prendo i primi 6 caratteri
						codtoedit = testriga.VariantRow.Left(6);
					}
					else
					{
						codtoedit =  testriga.VariantRow;
					}
					MyConf.LoadConfigurazione(codtoedit);
				}
				else
				{
					MyConf.NewConfiguration();
					
				}
				
				MyConf.MyConfigurazione.Cliente = Document.DBTSaleOrder.TMA_SaleOrd.fld_Customer.Value;
				
				editconfig = false;
				
				
				MyConf.ShowDialog();
				
				if(MyConf.DialogResult == DialogResult.OK)
				{
					//var variante = (DoorsAddoOnLibrary.ConfiguratorCloseEventArgs)ea;
					
					var variante = MyConf.ConfResult;
					
					TDBTDetail_MA_SaleOrdDetails riga = Document.DBTDetail.GetCurrentRow();
					
					
					Document.DBTDetail.CastToMyRecord(riga).fld_Item.Value = variante.Item;
					Document.DBTDetail.CastToMyRecord(riga).fld_Item.FireValueChanged();
					
					var descri = riga.fld_Description.Value;
					
					var index = descri.IndexOf("L.");
					var strdel = descri.Substring(index, 11);
					
					var strtochange = "L." + variante.MyConfigurazione.LarghezzaInternoBattutaCalcolata.ToString() +
						" H." + variante.MyConfigurazione.AltezzaInternoBattutaCalcolata.ToString();
					
					var descrivariante = descri.Replace(strdel, strtochange);

					Document.DBTDetail.CastToMyRecord(riga).fld_Description.Value = descrivariante;
					Document.DBTDetail.CastToMyRecord(riga).fld_Description.FireValueChanged();
					
					
					
					Document.DBTDetail.CastToMyRecord(riga).fld_Variant.Value = variante.Variante;
					Document.DBTDetail.CastToMyRecord(riga).fld_Variant.FireValueChanged();
					
					Document.DBTDetail.CastToMyRecord(riga).fld_DoorsAltezza.Value = variante.MyConfigurazione.Altezza;
					Document.DBTDetail.CastToMyRecord(riga).fld_DoorsLarghezza.Value = variante.MyConfigurazione.Larghezza;
					Document.DBTDetail.CastToMyRecord(riga).fld_DoorsSpMuro.Value = variante.MyConfigurazione.SpessoreMuro;
					
					//edito la configurazione
					string codiceconf = "";
					
					//codiceconf =  variante.MyConfigurazione.IdConfigurazione;
					codiceconf = variante.MyConfigurazione.IsVarianteStandard ? variante.Variante : variante.MyConfigurazione.IdConfigurazione;
					//var conf = MDConfigurazioni.Create();
					var conf = MDConfigurazioni.CreateUnattended(null);
					
					
					
					//var conf = MDConfigurazioni.Create();
					conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_IdGuid.Value = codiceconf;
					conf.BrowseRecord();
					conf.EditCurrentRecord();
					var test = conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_VarianteStandard.Value;
					conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_LineSaleOrd.Value =  Document.DBTDetail.TMA_SaleOrdDetails.fld_Line.Value;
					conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_LineSaleOrd.FireValueChanged();
					conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_PositionSaleOrd.Value = Document.DBTDetail.TMA_SaleOrdDetails.fld_Position.Value;
					conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_PositionSaleOrd.FireValueChanged();
					conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_SaleOrdId.Value = Document.DBTDetail.TMA_SaleOrdDetails.fld_SaleOrdId.Value;
					conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_SaleOrdId.FireValueChanged();

					
					conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_OkEdit.Value = variante.OkEdit;
					conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_OkEdit.FireValueChanged();
					conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_StartVariants.Value=true;
					conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_StartVariants.FireValueChanged();
					
					conf.SaveCurrentRecord();
					conf.Close();
					
					//salvo il riferimento alla configurazione nel rigo
					Document.DBTDetail.GetCurrentRow().fld_ReferenceDocNo.Value =  codiceconf;
					Document.DBTDetail.GetCurrentRow().fld_ReferenceDocNo.FireValueChanged();
					
					//calcolo prezzi
					TDBTDetail_MA_SaleOrdDetails rigaConPrezzi = calcolaPrezzo(riga, true); //true perchè gestisce le maggiorazioni
					riga.fld_UnitValue.FireValueChanged();
					//assegno i dati
					Document.DBTDetail.CastToMyRecord(riga).fld_DoorsPrezzoBase.Value = rigaConPrezzi.fld_DoorsPrezzoBase.Value;
					Document.DBTDetail.CastToMyRecord(riga).fld_DoorsSC1PB.Value = rigaConPrezzi.fld_DoorsSC1PB.Value;
					Document.DBTDetail.CastToMyRecord(riga).fld_DoorsSC2PB.Value = rigaConPrezzi.fld_DoorsSC2PB.Value;
					Document.DBTDetail.CastToMyRecord(riga).fld_DoorsSC3PB.Value = rigaConPrezzi.fld_DoorsSC3PB.Value;
					//
				}
				
				
				MyConf.OnClose += (o, ea) =>
				{
					
					
					//MyConf.Close();
				};
				
				
				MyConf.OnRunReport += (o, ea) =>
				{
					var bomea = (DoorsAddoOnLibrary.RunReportEventArgs)ea;
					MWoormInfo woormInfo = new MWoormInfo();
					woormInfo.Reports.Add("Report.doors.doors.StandaloneExplosion");
					MDataBool dataFalse = new MDataBool();
					MDataStr bom = new MDataStr();
					bom.Value = bomea.Bom;
					woormInfo.AddParameter("w_AskDialog", dataFalse);
					woormInfo.AddParameter("firstBOMCode",bom);
					woormInfo.AddParameter("lastBOMCode", bom);
					woormInfo.UI = MWoormInfo.ReportUI.Minimized;
					woormInfo.RunReports();
					woormInfo.CloseReports();
				};
				
				
				
				//and here
			}
			catch (System.Exception exc)
			{
				this.OnExceptionRaised(exc);
			}
		}
		
		public TDBTDetail_MA_SaleOrdDetails calcolaPrezzo(TDBTDetail_MA_SaleOrdDetails mRiga, bool mGestMagg)
		{
			TDBTDetail_MA_SaleOrdDetails riga = Document.DBTDetail.GetCurrentRow();
			try
			{
				//if(mRiga.fld_Variant.Value != "")
				//{
				string mRicMagg = "";
				string mProdCtg = "", mSubCtgProd = "", mApertura = "";
				//cerco i dati articolo per cercare i dati maggiorazioni
				Document.DMItems.FilterQuery = "Item = '" + mRiga.fld_Item.Value + "'";
				if(Document.DMItems.Read()==MDataManager.ReadResult.Found)
				{
					mProdCtg = Document.DMItems.TMA_Items.fld_ProductCtg.Value;
					mSubCtgProd = Document.DMItems.TMA_Items.fld_ProductSubCtg.Value;
					mApertura = Document.DMItems.TMA_Items.fld_DoorsApertura.Value;
					mRicMagg = "Prodctg = '" + Document.DMItems.TMA_Items.fld_ProductCtg.Value + "' AND ProdSubCtg = '" + Document.DMItems.TMA_Items.fld_ProductSubCtg.Value + "'";
					//assegno prezzo base
					riga.fld_DoorsPrezzoBase.Value = Document.DMItems.TMA_Items.fld_BasePrice.Value;
					//
				}
				Document.DMItems.Close();
				
				//cerco prima con il codice cliente
				bool mRicTutti = true;
				Document.DMDOORSMaggiorazioni.FilterQuery= mRicMagg + " AND Customer = '" + Document.DBTSaleOrder.TMA_SaleOrd.fld_Customer.Value + "'";
				if(Document.DMDOORSMaggiorazioni.Read()==MDataManager.ReadResult.Found)
				{
					mRicTutti = false;
					//assegno i dati per singolo cliente
					riga.fld_DoorsSC1PB.Value = Document.DMDOORSMaggiorazioni.TTAG_DOORS_Maggiorazioni.fld_Sconto1.Value;
					riga.fld_DoorsSC2PB.Value = Document.DMDOORSMaggiorazioni.TTAG_DOORS_Maggiorazioni.fld_Sconto2.Value;
					riga.fld_DoorsSC3PB.Value = Document.DMDOORSMaggiorazioni.TTAG_DOORS_Maggiorazioni.fld_Sconto3.Value;
					//assegno sconti maggiorazioni
					if(mGestMagg)
					{
						riga.fld_DoorsSC1Magg.Value = Document.DMDOORSMaggiorazioni.TTAG_DOORS_Maggiorazioni.fld_ScontoMagg1.Value;
						riga.fld_DoorsSC2Magg.Value = Document.DMDOORSMaggiorazioni.TTAG_DOORS_Maggiorazioni.fld_ScontoMagg2.Value;
						riga.fld_DoorsSC3Magg.Value = Document.DMDOORSMaggiorazioni.TTAG_DOORS_Maggiorazioni.fld_ScontoMagg3.Value;
					}

					//assegno la percentuale della provvigione Agente
					riga.fld_CommPercAuto.Value = false;
					riga.fld_CommPercAuto.FireValueChanged();
					riga.fld_CommPerc.Value = Document.DMDOORSMaggiorazioni.TTAG_DOORS_Maggiorazioni.fld_Provvigione.Value;
					riga.fld_CommPerc.FireValueChanged();
				}
				Document.DMDOORSMaggiorazioni.Close();
				
				//se non lo trovo per cliente specifico cerco per tutti i clienti
				if(mRicTutti)
				{
					Document.DMDOORSMaggiorazioni.FilterQuery= mRicMagg + " AND Customer = '*'";
					if(Document.DMDOORSMaggiorazioni.Read()==MDataManager.ReadResult.Found)
					{
						//assegno i dati per tutti
						riga.fld_DoorsSC1PB.Value = Document.DMDOORSMaggiorazioni.TTAG_DOORS_Maggiorazioni.fld_Sconto1.Value;
						riga.fld_DoorsSC2PB.Value = Document.DMDOORSMaggiorazioni.TTAG_DOORS_Maggiorazioni.fld_Sconto2.Value;
						riga.fld_DoorsSC3PB.Value = Document.DMDOORSMaggiorazioni.TTAG_DOORS_Maggiorazioni.fld_Sconto3.Value;
						//assegno sconti maggiorazioni
						if(mGestMagg)
						{
							riga.fld_DoorsSC1Magg.Value = Document.DMDOORSMaggiorazioni.TTAG_DOORS_Maggiorazioni.fld_ScontoMagg1.Value;
							riga.fld_DoorsSC2Magg.Value = Document.DMDOORSMaggiorazioni.TTAG_DOORS_Maggiorazioni.fld_ScontoMagg2.Value;
							riga.fld_DoorsSC3Magg.Value = Document.DMDOORSMaggiorazioni.TTAG_DOORS_Maggiorazioni.fld_ScontoMagg3.Value;
						}
						//assegno la percentuale della provvigione Agente
						riga.fld_CommPercAuto.Value = false;
						riga.fld_CommPercAuto.FireValueChanged();
						riga.fld_CommPerc.Value = Document.DMDOORSMaggiorazioni.TTAG_DOORS_Maggiorazioni.fld_Provvigione.Value;
						riga.fld_CommPerc.FireValueChanged();
					}
					Document.DMDOORSMaggiorazioni.Close();
				}
				
				//inizio gestione maggiorazioni
				if(mGestMagg)
				{
					//ottengo il codice configurazione
					string mCodConf = riga.fld_Variant.Value.ToString().Substring(0,6);
					MDataInt mRigaMagg = new MDataInt();
					mRigaMagg.Value = 0;
					//apro la configurazione per riempire il corpo maggiorazioni
					MDConfigurazioni conf = MDConfigurazioni.CreateUnattended(null);
					
					conf.DBTDOORSConfigurazioni.TTAG_DOORS_Configurazioni.fld_IdGuid.Value = mCodConf;
					conf.BrowseRecord();
					conf.EditCurrentRecord();
					
					//calcolo il prezzo con i dati dell'articolo/maggiorazione (dimensione, articolo e apertura) riempo il corpo della configurazione
					//costruisco la stringa del filtro
					string mFiltroQ = "";
					if(mRicTutti) //filtro per tutti i clienti
					{
						mFiltroQ="CtgProd = '" + mProdCtg + "' AND SubCtgProd = '" + mSubCtgProd + "' AND Customer = '*'";
					}
					else //filtro per cliente specifico
					{
						mFiltroQ="CtgProd = '" + mProdCtg + "' AND SubCtgProd = '" + mSubCtgProd + "' AND Customer = '" +
							Document.DBTSaleOrder.TMA_SaleOrd.fld_Customer.Value + "'";
					}
					
					//cerco prima per tipo maggiorazione "Dimensione/altezza"
					Document.DMDOORSMaggiorazioniDetail.FilterQuery = mFiltroQ + " AND TipoMaggiorazione = " + Enums.TipoMaggiorazione.Dimensioni + " AND Dimensione = " + Enums.Dimensioni.Altezza;
					while(Document.DMDOORSMaggiorazioniDetail.Read()==MDataManager.ReadResult.Found)
					{
						//se la altezza si trova nel range aggiungo il rigo e incremento l'importo maggiorazione
						if(riga.fld_DoorsAltezza.Value >= Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_DaDim.Value &&
						   riga.fld_DoorsAltezza.Value <= Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_ADim.Value)
						{
							mRigaMagg.Value++;
							TDBTDOORSConfigMagg_TAG_DOORS_ConfigMagg rigaMagg = conf.DBTDOORSConfigMagg.AddRow();
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_IdGuid.Value = mCodConf;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Line.Value = mRigaMagg.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_RigaMagg.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Riga.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_CtgProd.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_CtgProd.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_SubCtgProd.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_SubCtgProd.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Customer.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Customer.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_TipoMaggiorazione.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_TipoMaggiorazione.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Dimensione.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Dimensione.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_DaDim.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_DaDim.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_ADim.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_ADim.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Descrizione.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Descrizione.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Importo.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Importo.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_OltreStandard.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_OltreStandard.Value;
							//sommo l'importo maggiorazione
							riga.fld_DoorsMaggiorazione.Value += Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Importo.Value;
						}
					}
					Document.DMDOORSMaggiorazioniDetail.Close();
					
					//cerco prima per tipo maggiorazione "Dimensione/larghezza"
					Document.DMDOORSMaggiorazioniDetail.FilterQuery = mFiltroQ + " AND TipoMaggiorazione = " + Enums.TipoMaggiorazione.Dimensioni + " AND Dimensione = " + Enums.Dimensioni.Larghezza;
					while(Document.DMDOORSMaggiorazioniDetail.Read()==MDataManager.ReadResult.Found)
					{
						//se la larghezza si trova nel range aggiungo il rigo e incremento l'importo maggiorazione
						if(riga.fld_DoorsLarghezza.Value >= Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_DaDim.Value &&
						   riga.fld_DoorsLarghezza.Value <= Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_ADim.Value)
						{
							mRigaMagg.Value++;
							TDBTDOORSConfigMagg_TAG_DOORS_ConfigMagg rigaMagg = conf.DBTDOORSConfigMagg.AddRow();
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_IdGuid.Value = mCodConf;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Line.Value = mRigaMagg.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_RigaMagg.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Riga.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_CtgProd.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_CtgProd.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_SubCtgProd.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_SubCtgProd.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Customer.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Customer.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_TipoMaggiorazione.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_TipoMaggiorazione.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Dimensione.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Dimensione.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_DaDim.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_DaDim.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_ADim.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_ADim.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Descrizione.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Descrizione.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Importo.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Importo.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_OltreStandard.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_OltreStandard.Value;
							//sommo l'importo maggiorazione
							riga.fld_DoorsMaggiorazione.Value += Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Importo.Value;
						}
					}
					Document.DMDOORSMaggiorazioniDetail.Close();
					
					//cerco prima per tipo maggiorazione "Dimensione/Profondità"
					Document.DMDOORSMaggiorazioniDetail.FilterQuery = mFiltroQ + " AND TipoMaggiorazione = " + Enums.TipoMaggiorazione.Dimensioni + " AND Dimensione = " + Enums.Dimensioni.Prodondita;
					while(Document.DMDOORSMaggiorazioniDetail.Read()==MDataManager.ReadResult.Found)
					{
						//se la profondità si trova nel range aggiungo il rigo e incremento l'importo maggiorazione
						if(riga.fld_DoorsSpMuro.Value >= Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_DaDim.Value &&
						   riga.fld_DoorsSpMuro.Value <= Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_ADim.Value)
						{
							mRigaMagg.Value++;
							TDBTDOORSConfigMagg_TAG_DOORS_ConfigMagg rigaMagg = conf.DBTDOORSConfigMagg.AddRow();
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_IdGuid.Value = mCodConf;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Line.Value = mRigaMagg.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_RigaMagg.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Riga.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_CtgProd.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_CtgProd.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_SubCtgProd.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_SubCtgProd.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Customer.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Customer.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_TipoMaggiorazione.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_TipoMaggiorazione.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Dimensione.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Dimensione.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_DaDim.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_DaDim.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_ADim.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_ADim.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Descrizione.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Descrizione.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Importo.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Importo.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_OltreStandard.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_OltreStandard.Value;
							//sommo l'importo maggiorazione
							riga.fld_DoorsMaggiorazione.Value += Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Importo.Value;
						}
					}
					Document.DMDOORSMaggiorazioniDetail.Close();
					
					//cerco per tipo maggiorazione di tipo "Apertura"
					Document.DMDOORSMaggiorazioniDetail.FilterQuery = mFiltroQ + " AND TipoMaggiorazione = " + Enums.TipoMaggiorazione.TipoApertura + " AND Apertura = '" + mApertura + "'";
					if(Document.DMDOORSMaggiorazioniDetail.Read()==MDataManager.ReadResult.Found)
					{
						mRigaMagg.Value++;
						TDBTDOORSConfigMagg_TAG_DOORS_ConfigMagg rigaMagg = conf.DBTDOORSConfigMagg.AddRow();
						conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_IdGuid.Value = mCodConf;
						conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Line.Value = mRigaMagg.Value;
						conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_RigaMagg.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Riga.Value;
						conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_CtgProd.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_CtgProd.Value;
						conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_SubCtgProd.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_SubCtgProd.Value;
						conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Customer.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Customer.Value;
						conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_TipoMaggiorazione.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_TipoMaggiorazione.Value;
						conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Dimensione.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Dimensione.Value;
						conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Descrizione.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Descrizione.Value;
						conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Importo.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Importo.Value;
						conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Apertura.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Apertura.Value;
						//sommo l'importo maggiorazione
						riga.fld_DoorsMaggiorazione.Value += Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Importo.Value;
					}
					Document.DMDOORSMaggiorazioniDetail.Close();
					
					//cerco per tipo maggiorazione di tipo "Articoli"
					Document.DMDOORSMaggiorazioniDetail.FilterQuery = mFiltroQ + " AND TipoMaggiorazione = " + Enums.TipoMaggiorazione.Articolo;
					while(Document.DMDOORSMaggiorazioniDetail.Read()==MDataManager.ReadResult.Found)
					{
						//se l'articolo è presente nella configurazione lo aggiungo nelle maggiorazioni
						Document.DMDOORSConfigurazioniDetail.FilterQuery = "IdGuid = '" + mCodConf + "' AND Component = '" +
							Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Item.Value + "'";
						
						if(Document.DMDOORSConfigurazioniDetail.Read() == MDataManager.ReadResult.Found)
						{
							mRigaMagg.Value++;
							TDBTDOORSConfigMagg_TAG_DOORS_ConfigMagg rigaMagg = conf.DBTDOORSConfigMagg.AddRow();
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_IdGuid.Value = mCodConf;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Line.Value = mRigaMagg.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_RigaMagg.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Riga.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_CtgProd.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_CtgProd.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_SubCtgProd.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_SubCtgProd.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Customer.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Customer.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_TipoMaggiorazione.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_TipoMaggiorazione.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Dimensione.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Dimensione.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Descrizione.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Descrizione.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Importo.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Importo.Value;
							conf.DBTDOORSConfigMagg.CastToMyRecord(rigaMagg).fld_Item.Value = Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Item.Value;
							//sommo l'importo maggiorazione
							riga.fld_DoorsMaggiorazione.Value += Document.DMDOORSMaggiorazioniDetail.TTAG_DOORS_MaggiorazioniDetail.fld_Importo.Value;
						}
						Document.DMDOORSConfigurazioniDetail.Close();
					}
					Document.DMDOORSMaggiorazioniDetail.Close();
					//
					
					conf.SaveCurrentRecord();
					conf.Close();
				}
				//fine gestione maggiorazioni
				
				//assegno gli sconti su Prezzo Base
				MDataMon mValUnitScontato = new MDataMon();
				mValUnitScontato.Value = riga.fld_DoorsPrezzoBase.Value;
				
				if(riga.fld_DoorsSC1PB.Value != 0) //evitare eccezione divisione per zero
				{
					mValUnitScontato.Value = mValUnitScontato.Value - (mValUnitScontato.Value * (riga.fld_DoorsSC1PB.Value / 100));
				}
				if(riga.fld_DoorsSC2PB.Value != 0)
				{
					mValUnitScontato.Value = mValUnitScontato.Value - (mValUnitScontato.Value * (riga.fld_DoorsSC2PB.Value / 100));
				}
				if(riga.fld_DoorsSC3PB.Value != 0)
				{
					mValUnitScontato.Value = mValUnitScontato.Value - (mValUnitScontato.Value * (riga.fld_DoorsSC3PB.Value / 100));
				}

				//assegno sconti su Maggiorazioni
				if(mGestMagg)
				{
					MDataMon mMaggScontata = new MDataMon();
					mMaggScontata.Value = riga.fld_DoorsMaggiorazione.Value;
					
					if(riga.fld_DoorsSC1Magg.Value != 0) //evitare eccezione divisione per zero
					{
						mMaggScontata.Value = mMaggScontata.Value - (mMaggScontata.Value * (riga.fld_DoorsSC1Magg.Value / 100));
					}
					if(riga.fld_DoorsSC2Magg.Value != 0)
					{
						mMaggScontata.Value = mMaggScontata.Value - (mMaggScontata.Value * (riga.fld_DoorsSC2Magg.Value / 100));
					}
					if(riga.fld_DoorsSC3Magg.Value != 0)
					{
						mMaggScontata.Value = mMaggScontata.Value - (mMaggScontata.Value * (riga.fld_DoorsSC3Magg.Value / 100));
					}
					//assegno il valore unitario con la maggiorazione
					riga.fld_UnitValue.Value = mValUnitScontato.Value + mMaggScontata.Value;
				}
				else
				{
					riga.fld_UnitValue.Value = mValUnitScontato.Value;
				}
				//fine sconti maggiorazioni
				//}
			}
			catch (System.Exception exc)
			{
				this.OnExceptionRaised(exc);
			}
			return riga;
		}

	}
}
